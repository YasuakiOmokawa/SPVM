<html>
  <head>
    <title>SPVMエクスチェンジAPI仕様 1.0 ベータ</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="/images/spvm-logo.png">
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <script type="text/javascript" src="/js/jquery-1.9.0.min.js"></script>
    <script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
    <link  type="text/css" rel="stylesheet" href="/js/google-code-prettify/prettify.css"/>
    <script>
      $(function(){
        // google code prettifyの有効化
        $("pre").addClass("prettyprint");
        function init(event){
          prettyPrint();
        }
        if(window.addEventListener)window.addEventListener("load",init,false);
        else if(window.attachEvent)window.attachEvent("onload",init);
        
        $(".to-top").click(function() {
          // ページの一番上までスクロールさせます。
          $('body, html').animate({scrollTop: 0}, 300, 'linear');;
        });
      });
    </script>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <h1>
          <a style="color:#333;text-decoration:none;" href="/language.html"><img src="/images/spvm-logo.png">SPVMエクスチェンジAPI仕様 1.0ベータ</a>
        </h1>
      </div>
    </div>
    
    <div class="container">
      <h2 id="exchange-api-summary">SPVMエクスチェンジAPI仕様</a></h2>
      <p>
        <b>SPVMエクスチェンジAPI仕様</b>がこのドキュメントには記述されています。SPVMは、1.0のリリースに向けて、ベータテスト中です。言語仕様は、警告なく変更されることがあります。
      </p>
      <p>
        最終更新日 2019年4月24日
      </p>
      <h2 id="exchange-api-toc">目次</h2>
      <ul class="toc">
        <li><a href="#exchange-api-summary">SPVMエクスチェンジAPIとは</a></li>
        <li><a href="#exchange-api-perl-to-spvm">Perlのデータ構造をSPVMのデータ構造に変換する</a></li>
     </ul>
      
      <h2 id="exchange-api-summary">SPVMエクスチェンジAPIとは</h2>
      <p>
        SPVMエクスチェンジAPIとは、PerlとSPVMのデータ構造を変換、PerlからSPVMのサブルーチンを呼び出すためのAPIのことです。
      </p>
      <ul class="list">
        <li>Perlの数値や文字列や配列などのデータ構造をSPVMのデータ構造に変換</li>
        <li>SPVMのデータ構造をPerlの数値や文字列や配列などのデータ構造に変換</li>
        <li>SPVMのサブルーチンを呼び出す</li>
        <li>SPVMのサブルーチンを呼び出すためのPerlモジュールとの紐づけ</li>
      </ul>
      <p>
        SPVMで作成されたモジュールは、コンパイル終了後に、Perlのモジュールとして、そのまま実行できるようになります。
      </p>

      <h2 id="exchange-api-perl-to-spvm">Perlのデータ構造をSPVMのデータ構造に変換する</h2>
      <ul class="toc">
        <li><a href="#exchange-api-perl-to-spvm-byte-array">Perlの配列リファレンスをSPVMのbyte[]型に変換</a></li>
        <li><a href="#exchange-api-perl-to-spvm-short-array">Perlの配列リファレンスをSPVMのshort[]型に変換</a></li>
        <li><a href="#exchange-api-perl-to-spvm-int-array">Perlの配列リファレンスをSPVMのint型[]に変換</a></li>
        <li><a href="#exchange-api-perl-to-spvm-long-array">Perlの配列リファレンスをSPVMのlong[]型に変換</a></li>
        <li><a href="#exchange-api-perl-to-spvm-float-array">Perlの配列リファレンスをSPVMのfloat[]型に変換</a></li>
        <li><a href="#exchange-api-perl-to-spvm-double-array">Perlの配列リファレンスをSPVMのdouble[]型に変換</a></li>
      </ul>
      <h3 id="exchange-api-perl-to-spvm-byte-array">Perlの配列リファレンスをSPVMのbyte[]型に変換</h3>
      <p>
        SPVM::new_barray関数を使うと、Perlの配列リファレンスをSPVMのbyte[]型に変換することができます。
      </p>
<pre>
my $spvm_nums = SPVM::new_barray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのbyte型に変換されます。
      </p>
<pre>
(int8_t)SvIV(sv_value)
</pre>
      <p>
      <p>
        戻り値は、SPVMの「byte[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-to-spvm-short-array">Perlの配列リファレンスをSPVMのshort[]型に変換</h3>
      <p>
        SPVM::new_sarray関数を使うと、Perlの配列リファレンスをSPVMのshort[]型に変換することができます。
      </p>
<pre>
my $spvm_nums = SPVM::new_sarray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのshort型に変換されます。
      </p>
<pre>
(int16_t)SvIV(sv_value)
</pre>
      <p>
        戻り値は、SPVMの「short[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-to-spvm-int-array">Perlの配列リファレンスをSPVMのint[]型に変換</h3>
      <p>
        SPVM::new_iarray関数を使うと、Perlの配列リファレンスをSPVMのint[]型に変換することができます。
      </p>
<pre>
my $spvm_nums = SPVM::new_iarray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのint型に変換されます。
      </p>
<pre>
(int32_t)SvIV(sv_value)
</pre>
      <p>
        戻り値は、SPVMの「int[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-to-spvm-long-array">Perlの配列リファレンスをSPVMのlong[]型に変換</h3>
      <p>
        SPVM::new_larray関数を使うと、Perlの配列リファレンスをSPVMのlong[]型に変換することができます。
      </p>
<pre>
my $spvm_nums = SPVM::new_larray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのlong型に変換されます。
      </p>
<pre>
(int64_t)SvIV(sv_value)
</pre>
      <p>
        戻り値は、SPVMの「long[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-to-spvm-float-array">Perlの配列リファレンスをSPVMのfloat[]型に変換</h3>
      <p>
        SPVM::new_farray関数を使うと、Perlの配列リファレンスをSPVMのfloat[]型に変換することができます。
      </p>
<pre>
my $spvm_nums = SPVM::new_farray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのfloat型に変換されます。
      </p>
<pre>
(float)SvNV(sv_value)
</pre>
      <p>
      <p>
        戻り値は、SPVMの「float[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-to-spvm-double-array">Perlの配列リファレンスをSPVMのdouble[]型に変換</h3>
      <p>
        SPVM::new_darray関数を使うと、Perlの配列リファレンスをSPVMのdouble[]型に変換することができます。
      </p>
<pre>
my $spvm_nums = SPVM::new_darray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのdouble型に変換されます。
      </p>
<pre>
(double)SvNV(sv_value)
</pre>
      <p>
      <p>
        戻り値は、SPVMの「double[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>
    </div>
    
    <div class="footer">
      <div><a href="javascript:void(0)" class="to-top">▲</a></div>
      <a href="https://github.com/yuki-kimoto/SPVM">SPVMプロジェクト</a>
    </div>
  </body>
</html>
