<html>
  <head>
    <title>SPVMエクスチェンジAPI仕様 1.0 ベータ</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="/images/spvm-logo.png">
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <script type="text/javascript" src="/js/jquery-1.9.0.min.js"></script>
    <script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
    <link  type="text/css" rel="stylesheet" href="/js/google-code-prettify/prettify.css"/>
    <script>
      $(function(){
        // google code prettifyの有効化
        $("pre").addClass("prettyprint");
        function init(event){
          prettyPrint();
        }
        if(window.addEventListener)window.addEventListener("load",init,false);
        else if(window.attachEvent)window.attachEvent("onload",init);
        
        $(".to-top").click(function() {
          // ページの一番上までスクロールさせます。
          $('body, html').animate({scrollTop: 0}, 300, 'linear');;
        });
      });
    </script>
  </head>
  <body>
    <div class="header">
      <div class="container">
        <h1>
          <a style="color:#333;text-decoration:none;" href="/language.html"><img src="/images/spvm-logo.png">SPVMエクスチェンジAPI仕様 1.0ベータ</a>
        </h1>
      </div>
    </div>
    
    <div class="container">
      <div>
        <a href="/">SPVMドキュメント</a> &gt SPVMエクスチェンジAPI仕様
      </div>
      <h2 id="exchange-api-summary">SPVMエクスチェンジAPI仕様</a></h2>
      <p>
        <b>SPVMエクスチェンジAPI仕様</b>がこのドキュメントには記述されています。SPVMは、1.0のリリースに向けて、ベータテスト中です。SPVMエクスチェンジAPI仕様は、警告なく変更されることがあります。
      </p>
      <p>
        最終更新日 2019年5月4日
      </p>
      <h2 id="exchange-api-toc">目次</h2>
      <ul class="toc">
        <li><a href="#exchange-api-summary">SPVMエクスチェンジAPIとは</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm">Perlのデータ構造をSPVMのデータ構造に変換する</a></li>
        <li><a href="#exchange-api-utility">ユーティリティ</a></li>
      </ul>
      
      <h2 id="exchange-api-summary">SPVMエクスチェンジAPIとは</h2>
      <p>
        SPVMエクスチェンジAPIとは、PerlとSPVMのデータ構造を変換、PerlからSPVMのサブルーチンを呼び出すためのAPIのことです。
      </p>
      <ul class="list">
        <li>Perlの数値や文字列や配列などのデータ構造をSPVMのデータ構造に変換</li>
        <li>SPVMのデータ構造をPerlの数値や文字列や配列などのデータ構造に変換</li>
        <li>SPVMのサブルーチンを呼び出す</li>
        <li>SPVMのサブルーチンを呼び出すためのPerlモジュールとの紐づけ</li>
      </ul>
      <p>
        SPVMで作成されたモジュールは、コンパイル終了後に、Perlのモジュールとして、そのまま実行できるようになります。
      </p>

      <h2 id="exchange-api-perl-array-ref-to-spvm">Perlのデータ構造をSPVMのデータ構造に変換する</h2>
      <ul class="toc">
        <li><a href="#exchange-api-perl-scalar-to-SPVM-Byte">Perlのスカラ値をSPVMのSPVM::Byte型に変換 - SPVM::Byte-&gt;new</a></li>
        <li><a href="#exchange-api-perl-scalar-to-SPVM-Short">Perlのスカラ値をSPVMのSPVM::Short型に変換 - SPVM::Short-&gt;new</a></li>
        <li><a href="#exchange-api-perl-scalar-to-SPVM-Int">Perlのスカラ値をSPVMのSPVM::Int型に変換 - SPVM::Int-&gt;new</a></li>
        <li><a href="#exchange-api-perl-scalar-to-SPVM-Long">Perlのスカラ値をSPVMのSPVM::Long型に変換 - SPVM::Long-&gt;new</a></li>
        <li><a href="#exchange-api-perl-scalar-to-SPVM-Float">Perlのスカラ値をSPVMのSPVM::Float型に変換 - SPVM::Float-&gt;new</a></li>
        <li><a href="#exchange-api-perl-scalar-to-SPVM-Double">Perlのスカラ値をSPVMのSPVM::Double型に変換 - SPVM::Double-&gt;new</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-byte-array">Perlの配列リファレンスをSPVMのbyte[]型に変換 - SPVM::new_barray</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-short-array">Perlの配列リファレンスをSPVMのshort[]型に変換 - SPVM::new_sarray</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-int-array">Perlの配列リファレンスをSPVMのint型[]に変換 - SPVM::new_iarray</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-long-array">Perlの配列リファレンスをSPVMのlong[]型に変換 - SPVM::new_larray</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-float-array">Perlの配列リファレンスをSPVMのfloat[]型に変換 - SPVM::new_farray</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-double-array">Perlの配列リファレンスをSPVMのdouble[]型に変換 - SPVM::new_darray</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-byte-array">Perlのバイナリ列をSPVMのbyte[]型に変換 - SPVM::new_barray_from_bin</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-string">Perlのバイナリ列をSPVMのstring型に変換 - SPVM::new_str_from_bin</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-short-array">Perlのバイナリ列をSPVMのshort[]型に変換 - SPVM::new_sarray_from_bin</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-int-array">Perlのバイナリ列をSPVMのint[]型に変換 - SPVM::new_iarray_from_bin</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-long-array">Perlのバイナリ列をSPVMのlong[]型に変換 - SPVM::new_larray_from_bin</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-float-array">Perlのバイナリ列をSPVMのfloat[]型に変換 - SPVM::new_barray_from_str</a></li>
        <li><a href="#exchange-api-perl-binary-to-spvm-double-array">Perlのバイナリ列をSPVMのdouble[]型に変換 - SPVM::new_darray_from_bin</a></li>
        <li><a href="#exchange-api-perl-string-to-spvm-byte-array">Perlの文字列をSPVMのbyte[]型に変換 - SPVM::new_barray_from_str</a></li>
        <li><a href="#exchange-api-perl-string-to-spvm-string">Perlの文字列をSPVMのstring型に変換 - SPVM::new_str</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-hash-ref-to-SPVM-Hash">PerlのハッシュリファレンスをSPVMのSPVM::Hash型に変換 - SPVM::hash</a></li>
        <li><a href="#exchange-api-perl-array-ref-to-spvm-array-ref-to-SPVM-List">Perlの配列リファレンスをSPVMのSPVM::List型に変換 - SPVM::list</a></li>
      </ul>

      <h3 id="exchange-api-perl-scalar-to-SPVM-Byte">Perlのスカラ値をSPVMのSPVM::Byte型に変換 - SPVM::Byte-&gt;new</h3>
      <p>
        Perlのスカラ値をSPVMのSPVM::Byte型に変換するには、SPVM::Byte-&gt;newメソッドを使います。
      </p>
<pre>
my $spvm_byte = SPVM::Byte->new(98);
</pre>
      <p>
        Perlのスカラ値は、perlapiとC99の型変換による以下の変換によって、SPVMのbyte型に変換され、その値が、SPVM::Byteのnewメソッドに渡され、SPVM::Byte型のオブジェクトが返されます。
      </p>
<pre>
(int8_t)SvIV(sv_value)
</pre>

      <h3 id="exchange-api-perl-scalar-to-SPVM-Short">Perlのスカラ値をSPVMのSPVM::Short型に変換 - SPVM::Short-&gt;new</h3>
      <p>
        Perlのスカラ値をSPVMのSPVM::Short型に変換するには、SPVM::Short-&gt;newメソッドを使います。
      </p>
<pre>
my $spvm_short = SPVM::Short->new(9800);
</pre>
      <p>
        Perlのスカラ値は、perlapiとC99の型変換による以下の変換によって、SPVMのshort型に変換され、その値が、SPVM::Shortのnewメソッドに渡され、SPVM::Short型のオブジェクトが返されます。
      </p>
<pre>
(int16_t)SvIV(sv_value)
</pre>

      <h3 id="exchange-api-perl-scalar-to-SPVM-Int">Perlのスカラ値をSPVMのSPVM::Int型に変換 - SPVM::Int-&gt;new</h3>
      <p>
        Perlのスカラ値をSPVMのSPVM::Int型に変換するには、SPVM::Int-&gt;newメソッドを使います。
      </p>
<pre>
my $spvm_int = SPVM::Int->new(100000);
</pre>
      <p>
        Perlのスカラ値は、perlapiとC99の型変換による以下の変換によって、SPVMのint型に変換され、その値が、SPVM::Intのnewメソッドに渡され、SPVM::Int型のオブジェクトが返されます。
      </p>
<pre>
(int32_t)SvIV(sv_value)
</pre>

      <h3 id="exchange-api-perl-scalar-to-SPVM-Long">Perlのスカラ値をSPVMのSPVM::Long型に変換 - SPVM::Long-&gt;new</h3>
      <p>
        Perlのスカラ値をSPVMのSPVM::Long型に変換すると、SPVM::Long-&gt;newメソッドを使います。
      </p>
<pre>
my $spvm_long = SPVM::Long->new(98);
</pre>
      <p>
        Perlのスカラ値は、perlapiとC99の型変換による以下の変換によって、SPVMのlong型に変換され、その値が、SPVM::Longのnewメソッドに渡され、SPVM::Long型のオブジェクトが返されます。
      </p>
<pre>
(int64_t)SvIV(sv_value)
</pre>

      <h3 id="exchange-api-perl-scalar-to-SPVM-Float">Perlのスカラ値をSPVMのSPVM::Float型に変換 - SPVM::Float-&gt;new</h3>
      <p>
        Perlのスカラ値をSPVMのSPVM::Float型に変換するには、SPVM::Float-&gt;newメソッドを使います。
      </p>
<pre>
my $spvm_float = SPVM::Float->new(2.5);
</pre>
      <p>
        Perlのスカラ値は、perlapiとC99の型変換による以下の変換によって、SPVMのfloat型に変換され、その値が、SPVM::Floatのnewメソッドに渡され、SPVM::Float型のオブジェクトが返されます。
      </p>
<pre>
(float)SvNV(sv_value)
</pre>

      <h3 id="exchange-api-perl-scalar-to-SPVM-Double">Perlのスカラ値をSPVMのSPVM::Double型に変換 - SPVM::Double-&gt;new</h3>
      <p>
        Perlのスカラ値をSPVMのSPVM::Double型に変換するには、SPVM::Double-&gt;newメソッドを使います。
      </p>
<pre>
my $spvm_double = SPVM::Double->new(2.5);
</pre>
      <p>
        Perlのスカラ値は、perlapiとC99の型変換による以下の変換によって、SPVMのdouble型に変換され、その値が、SPVM::Doubleのnewメソッドに渡され、SPVM::Double型のオブジェクトが返されます。
      </p>
<pre>
(double)SvNV(sv_value)
</pre>

      <h3 id="exchange-api-perl-array-ref-to-spvm-byte-array">Perlの配列リファレンスをSPVMのbyte[]型に変換 - SPVM::new_barray</h3>
      <p>
        Perlの配列リファレンスをSPVMのbyte[]型に変換するには、SPVM::new_barray関数を使います。
      </p>
<pre>
my $spvm_nums = SPVM::new_barray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのbyte型に変換されます。
      </p>
<pre>
(int8_t)SvIV(sv_value)
</pre>
      <p>
      <p>
        戻り値は、SPVMの「byte[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-array-ref-to-spvm-short-array">Perlの配列リファレンスをSPVMのshort[]型に変換</h3>
      <p>
        Perlの配列リファレンスをSPVMのshort[]型に変換するには、SPVM::new_sarray関数を使います。
      </p>
<pre>
my $spvm_nums = SPVM::new_sarray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのshort型に変換されます。
      </p>
<pre>
(int16_t)SvIV(sv_value)
</pre>
      <p>
        戻り値は、SPVMの「short[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-array-ref-to-spvm-int-array">Perlの配列リファレンスをSPVMのint[]型に変換</h3>
      <p>
        Perlの配列リファレンスをSPVMのint[]型に変換するには、SPVM::new_iarray関数を使います。
      </p>
<pre>
my $spvm_nums = SPVM::new_iarray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのint型に変換されます。
      </p>
<pre>
(int32_t)SvIV(sv_value)
</pre>
      <p>
        戻り値は、SPVMの「int[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-array-ref-to-spvm-long-array">Perlの配列リファレンスをSPVMのlong[]型に変換</h3>
      <p>
        Perlの配列リファレンスをSPVMのlong[]型に変換するには、SPVM::new_larray関数を使います。
      </p>
<pre>
my $spvm_nums = SPVM::new_larray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのlong型に変換されます。
      </p>
<pre>
(int64_t)SvIV(sv_value)
</pre>
      <p>
        戻り値は、SPVMの「long[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-array-ref-to-spvm-float-array">Perlの配列リファレンスをSPVMのfloat[]型に変換</h3>
      <p>
        Perlの配列リファレンスをSPVMのfloat[]型に変換するには、SPVM::new_farray関数を使います。
      </p>
<pre>
my $spvm_nums = SPVM::new_farray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのfloat型に変換されます。
      </p>
<pre>
(float)SvNV(sv_value)
</pre>
      <p>
      <p>
        戻り値は、SPVMの「float[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-array-ref-to-spvm-double-array">Perlの配列リファレンスをSPVMのdouble[]型に変換</h3>
      <p>
        Perlの配列リファレンスをSPVMのdouble[]型に変換するには、SPVM::new_darray関数を使います。
      </p>
<pre>
my $spvm_nums = SPVM::new_darray([1, 2, 3]);
</pre>
      <p>
        第一引数に配列のリファレンスを受け取ります。
      </p>
      <p>
        配列のリファレンスのそれぞれの要素の値は、Perlのスカラ値から、perlapiとC99の型変換による以下の変換によって、SPVMのdouble型に変換されます。
      </p>
<pre>
(double)SvNV(sv_value)
</pre>
      <p>
      <p>
        戻り値は、SPVMの「double[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-binary-to-spvm-byte-array">Perlのバイナリ列をSPVMのbyte[]型に変換 - SPVM::new_barray_from_bin</h3>
      <p>
        Perlのバイナリ列をSPVMのbyte[]型に変換するには、SPVM::new_barray_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('c3', 97, 98, 99);
my $spvm_byte_array = SPVM::new_barray_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ8bit符号付整数の並びと解釈されます。長さは、8bit符号付整数として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「byte[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>
      <p>
        上記のサンプルは、次と同じ意味でもあります。バイナリ列は、8bit符号付整数の並びである場合は、packを使っても、Perlのdecodeされていない文字列でもかまいません。
      </p>
<pre>
my $binary = "abc";
my $spvm_byte_array = SPVM::new_barray_from_bin($perl_binary);
</pre>

      <h3 id="exchange-api-perl-binary-to-spvm-string">Perlのバイナリ列をSPVMのstring型に変換 - SPVM::new_str_from_bin</h3>

      <p>
        Perlのバイナリ列をSPVMのstring型に変換するには、SPVM::new_str_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('c3', 97, 98, 99);
my $spvm_byte_array = SPVM::new_str_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ8bit符号付整数の並びと解釈されます。長さは、8bit符号付整数として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「byte[]」型を表現した「SPVM::Data::Array」オブジェクトです。SPVMのstring型は実行時にはbyte[]型として扱われます。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>
      <p>
        上記のサンプルは、次と同じ意味でもあります。バイナリ列は、8bit符号付整数の並びである場合は、packを使っても、Perlのdecodeされていない文字列でもかまいません。
      </p>
<pre>
my $binary = "abc";
my $spvm_byte_array = SPVM::new_barray_from_bin($perl_binary);
</pre>

      <p>
        この関数は実際には、<a href="#exchange-api-perl-binary-to-spvm-byte-array">SPVM::new_barray_from_bin</a>のエイリアスです。
      </p>
      
      <h3 id="exchange-api-perl-binary-to-spvm-short-array">Perlのバイナリ列をSPVMのshort[]型に変換 - SPVM::new_sarray_from_bin</h3>
      <p>
        Perlのバイナリ列をSPVMのshort[]型に変換するには、SPVM::new_sarray_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('s3', 97, 98, 99);
my $spvm_short_array = SPVM::new_sarray_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ16bit符号付整数の並びと解釈されます。長さは、16bit符号付整数として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「short[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-binary-to-spvm-int-array">Perlのバイナリ列をSPVMのint[]型に変換 - SPVM::new_iarray_from_bin</h3>
      <p>
        Perlのバイナリ列をSPVMのint[]型に変換するには、SPVM::new_iarray_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('l3', 97, 98, 99);
my $spvm_int_array = SPVM::new_iarray_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ32bit符号付整数の並びと解釈されます。長さは、32bit符号付整数として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「int[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-binary-to-spvm-long-array">Perlのバイナリ列をSPVMのlong[]型に変換 - SPVM::new_larray_from_bin</h3>
      <p>
        Perlのバイナリ列をSPVMのlong[]型に変換するには、SPVM::new_larray_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('q3', 97, 98, 99);
my $spvm_long_array = SPVM::new_larray_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ64bit符号付整数の並びと解釈されます。長さは、64bit符号付整数として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「long[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-binary-to-spvm-float-array">Perlのバイナリ列をSPVMのfloat[]型に変換 - SPVM::new_farray_from_bin</h3>
      <p>
        Perlのバイナリ列をSPVMのfloat[]型に変換するには、SPVM::new_farray_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('f3', 0.5, 1.5, 2.5);
my $spvm_float_array = SPVM::new_farray_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ32bit浮動小数点の並びと解釈されます。長さは、32bit浮動小数点として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「float[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-binary-to-spvm-double-array">Perlのバイナリ列をSPVMのdouble[]型に変換 - SPVM::new_darray_from_bin</h3>
      <p>
        Perlのバイナリ列をSPVMのdouble[]型に変換するには、SPVM::new_darray_from_bin関数を使います。
      </p>
<pre>
my $perl_binary = pack('f3', 0.5, 1.5, 2.5);
my $spvm_double_array = SPVM::new_darray_from_bin($perl_binary);
</pre>
      <p>
        第一引数にPerlのバイナリ列を受け取ります。
      </p>
      <p>
        バイナリ列は、実行環境のバイトオーダーで並んだ32bit浮動小数点の並びと解釈されます。長さは、32bit浮動小数点として解釈された場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「double[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-string-to-spvm-byte-array">Perlの文字列をSPVMのbyte[]型に変換 - SPVM::new_barray_from_str</h3>
      <p>
        Perlの文字列をSPVMのbyte[]型に変換するには、SPVM::new_barray_from_str関数を使います。Perlの文字列は、ここではデコードされた文字列を指します。
      </p>
<pre>
use utf8;
my $spvm_byte_array = SPVM::new_barray_from_str("あいうえお");
</pre>
      <p>
        第一引数にPerlの文字列を受け取ります。Perlの文字列は、ここではデコードされた文字列を指します。
      </p>
      <p>
        長さは、UTF-8として、バイト列を数えた場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「byte[]」型を表現した「SPVM::Data::Array」オブジェクトです。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>

      <h3 id="exchange-api-perl-string-to-spvm-string">Perlの文字列をSPVMのstring型に変換 - SPVM::new_str</h3>
      <p>
        Perlの文字列をSPVMのstring型に変換するには、SPVM::new_str関数を使います。Perlの文字列は、ここではデコードされた文字列を指します。
      </p>
<pre>
use utf8;
my $spvm_string = SPVM::new_str("あいうえお");
</pre>
      <p>
        第一引数にPerlの文字列を受け取ります。
      </p>
      <p>
        長さは、UTF-8として、バイト列を数えた場合の長さになります。
      </p>
      <p>
        戻り値は、SPVMの「byte[]」型を表現した「SPVM::Data::Array」オブジェクトです。SPVMのstring型は実行時にはbyte[]型として扱われます。
      </p>
      <p>
        第一引数が未定義値だった場合は、未定義値が返ります。
      </p>
      <p>
        この関数は実際には、<a href="#exchange-api-perl-string-to-spvm-byte-array">SPVM::new_barray_from_str</a>のエイリアスです。
      </p>

      <h2 id="exchange-api-utility">ユーティリティ</h2>
      <ul class="toc">
        <li><a href="#exchange-api-utility-exception">SPVMの例外の取得 - exception</a></li>
        <li><a href="#exchange-api-utility-set_exception">SPVMの例外の設定 - set_exception</a></li>
        <li><a href="#exchange-api-utility-memory_blocks_count">確保されたメモリブロックの数を取得 - memory_blocks_count</a></li>
      <p>
        その他のユーティリティです。
      </p>

      <h3 id="exchange-api-utility-exception">SPVMの例外の取得 - exception</h3>
      <p>
        SPVMの例外を取得します。取得される文字列は、undefでなかった場合は、UTF-8とみなしてデコードされた文字列です。
      </p>
<pre>
my $exception = SPVM::exception();
</pre>

      <h3 id="exchange-api-utility-set_exception">SPVMの例外の設定 - set_exception</h3>
      <p>
        SPVMの例外を設定します。引数は、デコードされた文字列かundefを指定します。
      </p>
<pre>
SPVM::set_exception("あいう");
SPVM::set_exception(undef);
</pre>

      <h3 id="exchange-api-utility-memory_blocks_count">確保されたメモリブロックの数を取得 - memory_blocks_count</h3>
      <p>
        memory_blocks_count関数を使うと、確保されたメモリブロックの数を取得できます。
      </p>
<pre>
my $count = SPVM::memory_blocks_count();
</pre>
      <p>
        SPVMランタイムは、オブジェクトを生成するとき、ウィークリファレンスを新しく作成するときに、ヒープからメモリを確保します。一回のメモリ取得の操作によって確保されたメモリをメモリブロックと呼びます。
      </p>
      <p>
        SPVMは、リファレンスカウント式のGCを持っており、通常は、メモリの確保と解放については、意識する必要がありませんが、ネイティブでサブルーチンを記述するときは、メモリリークが起こっていないことを試験で確認したいという場合があるでしょう。
      </p>
<pre>
# 最初のメモリブロックカウント
my $start_memory_blocks_count = SPVM::memory_blocks_count();

# 処理
# ...

# 最後のメモリブロックカウント
my $end_memory_blocks_count = SPVM::memory_blocks_count();

unless ($end_memory_blocks_count == $start_memory_blocks_count) {
  die "Memroy leak";
}
</pre>

<!--
<pre>

=head2 memory_blocks_count(済み)

=head2 new_barray(済み)

=head2 new_barray_from_bin(済み)

=head2 new_barray_from_str(済み)

=head2 new_darray(済み)

=head2 new_darray_from_bin(済み)

=head2 new_farray(済み)

=head2 new_farray_from_bin(済み)

=head2 new_iarray(済み)

=head2 new_iarray_from_bin(済み)

=head2 new_larray(済み)

=head2 new_larray_from_bin(済み)

=head2 new_oarray

=head2 new_sarray(済み)

=head2 new_sarray_from_bin(済み)

=head2 new_str(済み)

=head2 new_str_from_bin(済み)

=head2 new_varray

=head2 new_varray_from_bin

=head2 hash

=head2 list

=head2 set_exception(済み)

=head2 exception(済み)

=head2 to_bin

=head2 to_elems

=head2 to_str

=head2 to_strs

</pre>
-->

    </div>
    
    <div class="footer">
      <div><a href="javascript:void(0)" class="to-top">▲</a></div>
      <a href="https://github.com/yuki-kimoto/SPVM">SPVMプロジェクト</a>
    </div>
  </body>
</html>
